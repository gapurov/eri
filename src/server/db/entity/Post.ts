import {
  Entity,
  Property,
  ManyToOne,
  OptionalProps,
  JsonType
} from "@mikro-orm/core"

import type {TPostCreateInput} from "server/trpc/type/input/PostCreateInput"
import type {TEditorData} from "server/trpc/type/common/EditorData"

import {BaseDates, OptionalDates} from "./BaseDates"
import {User} from "./User"

export interface PostInput extends TPostCreateInput {
  author: User
}

@Entity()
export class Post extends BaseDates implements PostInput {
  [OptionalProps]?: OptionalDates | "slug"

  /**
   * Post title
   */
  @Property()
  title: string

  /**
   * Post content, generated by Slate editor
   */
  @Property({type: JsonType})
  content!: TEditorData

  /**
   * Unique, human-readable Post identifier.
   */
  @Property({unique: true})
  slug!: string

  /**
   * Post author
   */
  @ManyToOne({eager: true})
  author!: User

  constructor({title, content, author}: PostInput) {
    super()

    this.title = title
    this.content = content
    this.author = author
  }
}
